name: delete old workflow runs
on:
    schedule:
        - cron: '0 0 * * *' # nightly
    push:
        branches:
            - master

jobs:
    delete_old_workflow_runs:
        runs-on: ubuntu-latest
        permissions:
            actions: write
            contents: read
        steps:
            - name: delete workflow runs
              uses: Mattraks/delete-workflow-runs@v2
              with:
                token: ${{ github.token }}
                repository: ${{ github.repository }}
                retain_days: 14
                keep_minimum_runs: 2

    purge_deleted_branch_workflows:
        runs-on: ubuntu-latest
        permissions:
            actions: write
            contents: read
        steps:
            - name: Check out repository code
              uses: actions/checkout@v4
            - name: purge workflows on deleted branches
              run: .github/scripts/github/gh-purge-deleted-branch-workflows.sh X11Libre/xserver
              env:
                GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
